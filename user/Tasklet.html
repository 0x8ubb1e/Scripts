<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="version" content="1.0.0">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>æ¯æ—¥ä»»åŠ¡æé†’</title>
	<style>
		body {
			font-family: 'Microsoft YaHei', sans-serif;
			margin: 0;
			padding: 0;
			background-color: #f5f5f5;
			user-select: none;
			box-sizing: border-box;
		}

		.task-container {
			width: 300px;
			background-color: white;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
			border-radius: 8px;
			position: absolute;
			top: 50px;
			left: 50px;
			overflow: hidden;
			resize: both;
			min-width: 280px;
			/* min-height: 350px; */
			max-width: 500px;
			max-height: 700px;
		}

		.task-header {
			background-color: #4CAF50;
			color: white;
			padding: 12px 15px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			cursor: move;
		}

		.task-title {
			font-weight: bold;
			font-size: 16px;
		}

		.task-controls {
			display: flex;
			gap: 8px;
		}

		.task-controls button {
			background: transparent;
			border: none;
			color: white;
			cursor: pointer;
			font-size: 16px;
			padding: 2px;
			width: 30px;
			height: 30px;
		}

		.task-list {
			max-height: 300px;
			overflow-y: auto;
			padding: 10px;
		}

		.task-item {
			padding: 10px;
			border-bottom: 1px solid #eee;
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.task-item:last-child {
			border-bottom: none;
		}

		.task-content {
			display: flex;
			flex-direction: column;
			flex-grow: 1;
		}

		.task-name {
			font-weight: bold;
			margin-bottom: 5px;
		}

		.task-time {
			font-size: 12px;
			color: #777;
		}

		.task-actions {
			display: flex;
			gap: 5px;
		}

		.task-actions button {
			background: transparent;
			border: none;
			cursor: pointer;
			font-size: 14px;
			color: #777;
		}

		.task-actions button:hover {
			color: #4CAF50;
		}

		.add-task {
			padding: 15px;
			border-top: 1px solid #eee;
		}

		.add-task input,
		.add-task button {
			width: 100%;
			padding: 8px;
			margin-bottom: 5px;
			border: 1px solid #ddd;
			border-radius: 4px;
			box-sizing: border-box;
		}

		.add-task button {
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
		}

		.add-task button:hover {
			background-color: #45a049;
		}

		.notification {
			position: fixed;
			top: 20px;
			right: 20px;
			background-color: #4CAF50;
			color: white;
			padding: 40px 30px 10px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			max-width: 300px;
			display: none;
		}

		.notification h3 {
			position: absolute;
			top: 10px;
			left: 10px;
			margin-top: 0;
			margin-bottom: 5px;
		}

		.notification p {
			margin: 5px 0;
		}

		.notification-close {
			position: absolute;
			top: 5px;
			right: 5px;
			background: transparent;
			border: none;
			color: white;
			cursor: pointer;
			font-size: 30px;
		}

		.empty-message {
			text-align: center;
			color: #888;
			padding: 20px;
			font-style: italic;
		}
	</style>
</head>

<body>
	<div class="task-container" id="taskContainer">
		<div class="task-header" id="taskHeader">
			<div class="task-title">æ¯æ—¥ä»»åŠ¡æé†’</div>
			<div class="task-controls">
				<button id="pinBtn" title="ç½®é¡¶/å–æ¶ˆç½®é¡¶">ğŸ“Œ</button>
				<button id="minimizeBtn" title="æœ€å°åŒ–">â”€</button>
			</div>
		</div>
		<div class="task-list" id="taskList">
			<div class="empty-message">æš‚æ— ä»»åŠ¡ï¼Œè¯·æ·»åŠ æ–°ä»»åŠ¡</div>
		</div>
		<div class="add-task">
			<input type="text" id="taskInput" placeholder="ä»»åŠ¡åç§°" maxlength="50">
			<input type="time" id="timeInput">
			<button id="addTaskBtn">æ·»åŠ ä»»åŠ¡</button>
		</div>
	</div>

	<div class="notification" id="notification">
		<button class="notification-close" id="notificationClose">Ã—</button>
		<h3>ä»»åŠ¡æé†’</h3>
		<p id="notificationTaskName"></p>
		<p id="notificationTaskTime"></p>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function () {
			const taskContainer = document.getElementById('taskContainer');
			const taskHeader = document.getElementById('taskHeader');
			const taskList = document.getElementById('taskList');
			const taskInput = document.getElementById('taskInput');
			const timeInput = document.getElementById('timeInput');
			const addTaskBtn = document.getElementById('addTaskBtn');
			const pinBtn = document.getElementById('pinBtn');
			const minimizeBtn = document.getElementById('minimizeBtn');
			const notification = document.getElementById('notification');
			const notificationClose = document.getElementById('notificationClose');
			const notificationTaskName = document.getElementById('notificationTaskName');
			const notificationTaskTime = document.getElementById('notificationTaskTime');

			let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
			let isPinned = localStorage.getItem('isPinned') === 'true';
			let isMinimized = localStorage.getItem('isMinimized') === 'true';
			let reminders = {};

			// åˆå§‹åŒ–
			function init () {
				renderTasks();
				setContainerPosition();
				setPinState();
				setMinimizeState();
				setupReminders();

				// è®¾ç½®å½“å‰æ—¶é—´ä¸ºé»˜è®¤æ—¶é—´
				const now = new Date();
				const hours = String(now.getHours()).padStart(2, '0');
				const minutes = String(now.getMinutes()).padStart(2, '0');
				timeInput.value = `${hours}:${minutes}`;
			}

			// æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
			function renderTasks () {
				if (tasks.length === 0) {
					taskList.innerHTML = '<div class="empty-message">æš‚æ— ä»»åŠ¡ï¼Œè¯·æ·»åŠ æ–°ä»»åŠ¡</div>';
					return;
				}

				taskList.innerHTML = '';
				tasks.forEach((task, index) => {
					const taskElement = document.createElement('div');
					taskElement.className = 'task-item';

					taskElement.innerHTML = `
						<div class="task-content">
							<div class="task-name">${task.name}</div>
							<div class="task-time">${task.time}</div>
						</div>
						<div class="task-actions">
							<button class="delete-task" data-index="${index}">âŒ</button>
						</div>
					`;

					taskList.appendChild(taskElement);
				});

				// æ·»åŠ åˆ é™¤äº‹ä»¶ç›‘å¬
				document.querySelectorAll('.delete-task').forEach(button => {
					button.addEventListener('click', function () {
						const index = parseInt(this.getAttribute('data-index'));
						deleteTask(index);
					});
				});
			}

			// æ·»åŠ æ–°ä»»åŠ¡
			function addTask (name, time) {
				if (!name.trim()) {
					alert('è¯·è¾“å…¥ä»»åŠ¡åç§°');
					return;
				}

				const newTask = {
					name: name.trim(),
					time: time
				};

				tasks.push(newTask);
				saveTasks();
				renderTasks();
				setupReminders();

				taskInput.value = '';
			}

			// åˆ é™¤ä»»åŠ¡
			function deleteTask (index) {
				if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
					tasks.splice(index, 1);
					saveTasks();
					renderTasks();
					setupReminders();
				}
			}

			// ä¿å­˜ä»»åŠ¡åˆ°æœ¬åœ°å­˜å‚¨
			function saveTasks () {
				localStorage.setItem('tasks', JSON.stringify(tasks));
			}

			// ä¿å­˜çª—å£ä½ç½®
			function saveContainerPosition () {
				localStorage.setItem('containerTop', taskContainer.style.top);
				localStorage.setItem('containerLeft', taskContainer.style.left);
			}

			// è®¾ç½®çª—å£ä½ç½®
			function setContainerPosition () {
				const savedTop = localStorage.getItem('containerTop');
				const savedLeft = localStorage.getItem('containerLeft');

				if (savedTop && savedLeft) {
					taskContainer.style.top = savedTop;
					taskContainer.style.left = savedLeft;
				}
			}

			// è®¾ç½®ç½®é¡¶çŠ¶æ€
			function setPinState () {
				if (isPinned) {
					taskContainer.style.zIndex = '9999';
					pinBtn.textContent = 'ğŸ“';
					pinBtn.title = 'å–æ¶ˆç½®é¡¶';
				} else {
					taskContainer.style.zIndex = '100';
					pinBtn.textContent = 'ğŸ“Œ';
					pinBtn.title = 'ç½®é¡¶';
				}
			}

			// è®¾ç½®æœ€å°åŒ–çŠ¶æ€
			function setMinimizeState () {
				if (isMinimized) {
					taskList.style.display = 'none';
					document.querySelector('.add-task').style.display = 'none';
					minimizeBtn.textContent = 'â–¢';
					minimizeBtn.title = 'è¿˜åŸ';
				} else {
					taskList.style.display = 'block';
					document.querySelector('.add-task').style.display = 'block';
					minimizeBtn.textContent = 'â”€';
					minimizeBtn.title = 'æœ€å°åŒ–';
				}
			}

			// è®¾ç½®æé†’
			function setupReminders () {
				// æ¸…é™¤æ‰€æœ‰å­˜åœ¨çš„æé†’
				for (const key in reminders) {
					clearTimeout(reminders[key]);
				}
				reminders = {};

				// ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®æ–°çš„æé†’
				tasks.forEach((task, index) => {
					const [hours, minutes] = task.time.split(':').map(Number);
					const now = new Date();
					const taskTime = new Date();

					taskTime.setHours(hours, minutes, 0, 0);

					// å¦‚æœä»»åŠ¡æ—¶é—´å·²è¿‡ï¼Œè®¾ç½®ä¸ºæ˜å¤©
					if (taskTime <= now) {
						taskTime.setDate(taskTime.getDate() + 1);
					}

					const timeUntilTask = taskTime.getTime() - now.getTime();

					reminders[index] = setTimeout(() => {
						showNotification(task.name, task.time);
						// è®¾ç½®ä¸‹ä¸€å¤©çš„æé†’
						setupReminders();
					}, timeUntilTask);
				});
			}

			// æ˜¾ç¤ºé€šçŸ¥
			function showNotification (taskName, taskTime) {
				notificationTaskName.textContent = `ä»»åŠ¡: ${taskName}`;
				notificationTaskTime.textContent = `æ—¶é—´: ${taskTime}`;
				notification.style.display = 'block';

				// æ’­æ”¾æç¤ºéŸ³
				const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
				audio.play().catch(e => console.log('æ— æ³•æ’­æ”¾æç¤ºéŸ³:', e));

				// å¦‚æœæµè§ˆå™¨æ”¯æŒé€šçŸ¥APIï¼Œåˆ™ä½¿ç”¨ç³»ç»Ÿé€šçŸ¥
				if ('Notification' in window && Notification.permission === 'granted') {
					new Notification('ä»»åŠ¡æé†’', {
						body: `ä»»åŠ¡: ${taskName} æ—¶é—´: ${taskTime}`,
						icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%234CAF50"/><text x="50" y="55" font-size="40" text-anchor="middle" fill="white">!</text></svg>'
					});
				}
			}

			// è¯·æ±‚é€šçŸ¥æƒé™
			if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {
				Notification.requestPermission();
			}

			// æ‹–åŠ¨çª—å£åŠŸèƒ½
			let isDragging = false;
			let offsetX, offsetY;

			taskHeader.addEventListener('mousedown', function (e) {
				isDragging = true;
				offsetX = e.clientX - taskContainer.getBoundingClientRect().left;
				offsetY = e.clientY - taskContainer.getBoundingClientRect().top;
				taskContainer.style.cursor = 'grabbing';
			});

			document.addEventListener('mousemove', function (e) {
				if (isDragging) {
					taskContainer.style.left = (e.clientX - offsetX) + 'px';
					taskContainer.style.top = (e.clientY - offsetY) + 'px';
				}
			});

			document.addEventListener('mouseup', function () {
				if (isDragging) {
					isDragging = false;
					taskContainer.style.cursor = 'default';
					saveContainerPosition();
				}
			});

			// äº‹ä»¶ç›‘å¬
			addTaskBtn.addEventListener('click', function () {
				addTask(taskInput.value, timeInput.value);
			});

			taskInput.addEventListener('keypress', function (e) {
				if (e.key === 'Enter') {
					addTask(taskInput.value, timeInput.value);
				}
			});

			pinBtn.addEventListener('click', function () {
				isPinned = !isPinned;
				localStorage.setItem('isPinned', isPinned);
				setPinState();
			});

			minimizeBtn.addEventListener('click', function () {
				isMinimized = !isMinimized;
				localStorage.setItem('isMinimized', isMinimized);
				setMinimizeState();
			});

			notificationClose.addEventListener('click', function () {
				notification.style.display = 'none';
			});

			// åˆå§‹åŒ–åº”ç”¨
			init();
		});
	</script>
</body>

</html>
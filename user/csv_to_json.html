<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta data="version" content="1.1.0">
	<title>脚本工具箱</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
			background: #fff;
			border-radius: 15px;
			box-shadow: 0 20px 40px rgba(0, 0, 0, .1);
			overflow: hidden;
		}

		.header {
			background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
			color: #fff;
			padding: 30px;
			text-align: center;
		}

		.header h1 {
			font-size: 2.5em;
			margin-bottom: 10px;
			font-weight: 300;
		}

		.header p {
			font-size: 1.1em;
			opacity: .9;
		}

		.main-content {
			padding: 30px;
		}

		.mode-selector {
			display: flex;
			justify-content: center;
			margin-bottom: 30px;
			gap: 15px;
			flex-wrap: wrap;
		}

		.mode-btn {
			padding: 12px 25px;
			border: 2px solid #4facfe;
			background: #fff;
			color: #4facfe;
			border-radius: 25px;
			cursor: pointer;
			font-size: 16px;
			font-weight: 500;
			transition: all .3s ease;
		}

		.mode-btn.active {
			background: #4facfe;
			color: #fff;
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(79, 172, 254, .3);
		}

		.mode-btn:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(79, 172, 254, .2);
		}

		.conversion-area {
			display: none;
		}

		.conversion-area.active {
			display: block;
		}

		.section-title {
			font-size: 1.3em;
			color: #333;
			margin-bottom: 15px;
			font-weight: 500;
		}

		.text-area {
			width: 100%;
			min-height: 200px;
			padding: 15px;
			border: 2px solid #e9ecef;
			border-radius: 8px;
			font-family: 'Courier New', monospace;
			font-size: 14px;
			resize: vertical;
			transition: border-color .3s ease;
		}

		.text-area:focus {
			outline: none;
			border-color: #4facfe;
		}

		.button-group {
			display: flex;
			gap: 15px;
			margin-top: 20px;
			flex-wrap: wrap;
		}

		.btn {
			padding: 12px 25px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			font-size: 16px;
			font-weight: 500;
			transition: all .3s ease;
		}

		.btn-primary {
			background: #4facfe;
			color: #fff;
		}

		.btn-primary:hover {
			background: #2196f3;
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(79, 172, 254, .3);
		}

		.btn-secondary {
			background: #6c757d;
			color: #fff;
		}

		.btn-secondary:hover {
			background: #5a6268;
			transform: translateY(-2px);
		}

		.btn-success {
			background: #28a745;
			color: #fff;
		}

		.btn-success:hover {
			background: #218838;
			transform: translateY(-2px);
		}

		.status-message {
			padding: 15px;
			border-radius: 8px;
			margin-top: 15px;
			display: none;
		}

		.status-success {
			background: #d4edda;
			color: #155724;
			border: 1px solid #c3e6cb;
		}

		.status-error {
			background: #f8d7da;
			color: #721c24;
			border: 1px solid #f5c6cb;
		}

		.progress-bar {
			width: 100%;
			height: 4px;
			background: #e9ecef;
			border-radius: 2px;
			overflow: hidden;
			margin-top: 10px;
			display: none;
		}

		.progress-fill {
			height: 100%;
			background: #4facfe;
			width: 0%;
			transition: width .3s ease;
		}

		/* ---- 时间戳模式额外小样式 ---- */
		.ts-options {
			display: flex;
			gap: 20px;
			align-items: center;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}

		.ts-options label {
			font-weight: 500;
		}

		.ts-options select {
			padding: 8px 12px;
			border: 1px solid #ced4da;
			border-radius: 4px;
		}

		.ts-box {
			display: flex;
			gap: 15px;
			flex-wrap: wrap;
		}

		.ts-box textarea {
			flex: 1 1 300px;
		}

		.ts-arrow {
			font-size: 2em;
			color: #4facfe;
			display: flex;
			align-items: center;
		}

		@media(max-width:768px) {
			.container {
				margin: 10px;
				border-radius: 10px;
			}

			.main-content {
				padding: 20px;
			}

			.mode-btn {
				font-size: 14px;
				padding: 10px 20px;
			}

			.ts-arrow {
				transform: rotate(90deg);
			}
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="header">
			<h1>CSV ↔ JSON ↔ 时间戳 转换工具</h1>
			<p>一站式数据格式互转</p>
		</div>

		<div class="main-content">
			<!-- 模式选择 -->
			<div class="mode-selector">
				<button class="mode-btn active" onclick="switchMode('csv-to-json')">CSV 转 JSON</button>
				<button class="mode-btn" onclick="switchMode('json-to-csv')">JSON 转 CSV</button>
				<button class="mode-btn" onclick="switchMode('ts-convert')">时间戳互转</button>
			</div>

			<!-- ====== 1. CSV → JSON （原功能，未改动）====== -->
			<div id="csv-to-json" class="conversion-area active">
				<div class="options-panel">
					<div class="option-group">
						<label>分隔符：</label>
						<select id="csv-delimiter">
							<option value=",">逗号 (,)</option>
							<option value=";">分号 (;)</option>
							<option value="\t">制表符</option>
							<option value="|">竖线 (|)</option>
						</select>
					</div>
					<div class="option-group">
						<label>包含表头：</label>
						<input type="checkbox" id="csv-headers" checked>
					</div>
				</div>

				<div class="input-section">
					<h3 class="section-title">输入 CSV 数据</h3>
					<input type="file" id="csv-file" accept=".csv" style="display:none">
					<label for="csv-file" class="file-input-label">选择 CSV 文件</label>
					<textarea id="csv-input" placeholder="在此粘贴 CSV 数据或选择文件..."></textarea>
				</div>
				<div class="button-group">
					<button class="btn btn-primary" onclick="convertCsvToJson()">转换为 JSON</button>
					<button class="btn btn-secondary" onclick="clearArea(['csv-input','csv-file'])">清除输入</button>
				</div>

				<div class="output-section">
					<h3 class="section-title">输出 JSON 数据</h3>
					<textarea id="json-output" readonly placeholder="转换后的 JSON 数据将显示在这里..."></textarea>
					<div class="button-group">
						<button class="btn btn-success" onclick="downloadText('json-output','data.json')">下载 JSON</button>
						<button class="btn btn-secondary" onclick="copyToClipboard('json-output')">复制到剪贴板</button>
					</div>
				</div>
			</div>

			<!-- ====== 2. JSON → CSV （原功能，未改动）====== -->
			<div id="json-to-csv" class="conversion-area">
				<div class="options-panel">
					<div class="option-group">
						<label>分隔符：</label>
						<select id="json-delimiter">
							<option value=",">逗号 (,)</option>
							<option value=";">分号 (;)</option>
							<option value="\t">制表符</option>
							<option value="|">竖线 (|)</option>
						</select>
					</div>
					<div class="option-group">
						<label>包含表头：</label>
						<input type="checkbox" id="json-headers" checked>
					</div>
				</div>

				<div class="input-section">
					<h3 class="section-title">输入 JSON 数据</h3>
					<input type="file" id="json-file" accept=".json" style="display:none">
					<label for="json-file" class="file-input-label">选择 JSON 文件</label>
					<textarea id="json-input" placeholder="在此粘贴 JSON 数据或选择文件..."></textarea>
				</div>
				<div class="button-group">
					<button class="btn btn-primary" onclick="convertJsonToCsv()">转换为 CSV</button>
					<button class="btn btn-secondary" onclick="clearArea(['json-input','json-file'])">清除输入</button>
				</div>

				<div class="output-section">
					<h3 class="section-title">输出 CSV 数据</h3>
					<textarea id="csv-output" readonly placeholder="转换后的 CSV 数据将显示在这里..."></textarea>
					<div class="button-group">
						<button class="btn btn-success" onclick="downloadText('csv-output','data.csv')">下载 CSV</button>
						<button class="btn btn-secondary" onclick="copyToClipboard('csv-output')">复制到剪贴板</button>
					</div>
				</div>
			</div>

			<!-- ====== 3. 时间戳 ⇄ 时间字符串 （新增）====== -->
			<div id="ts-convert" class="conversion-area">
				<div class="ts-options">
					<label>精度：
						<select id="ts-precision">
							<option value="s">秒 (10位)</option>
							<option value="ms" selected>毫秒 (13位)</option>
						</select>
					</label>
					<label>时区：
						<select id="ts-timezone">
							<option value="local">本地时区</option>
							<option value="utc">UTC</option>
						</select>
					</label>
				</div>

				<div class="ts-box">
					<div style="flex:1">
						<h3 class="section-title">时间戳</h3>
						<textarea id="ts-input" placeholder="输入时间戳 (秒/毫秒)..." style="min-height:160px"></textarea>
						<div class="button-group">
							<button class="btn btn-primary" onclick="tsToString()">→ 转字符串</button>
							<button class="btn btn-secondary" onclick="clearArea(['ts-input'])">清空</button>
						</div>
					</div>

					<div class="ts-arrow">⇄</div>

					<div style="flex:1">
						<h3 class="section-title">时间字符串</h3>
						<textarea id="ts-output" placeholder="转换后的时间字符串..." style="min-height:160px" readonly></textarea>
						<div class="button-group">
							<button class="btn btn-primary" onclick="stringToTs()">← 转时间戳</button>
							<button class="btn btn-secondary" onclick="copyToClipboard('ts-output')">复制</button>
						</div>
					</div>
				</div>

				<!-- 快速当前时间 -->
				<div style="margin-top:25px;text-align:center">
					<button class="btn btn-success" onclick="insertNow()">插入当前时间戳</button>
				</div>
			</div>

			<!-- 公共提示 & 进度 -->
			<div id="status-message" class="status-message"></div>
			<div id="progress-bar" class="progress-bar">
				<div id="progress-fill" class="progress-fill"></div>
			</div>
		</div>
	</div>

	<script>
		/* ================= 通用工具函数 ================= */
		function switchMode (mode) {
			currentMode = mode;
			document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
			event.target.classList.add('active');
			document.querySelectorAll('.conversion-area').forEach(a => a.classList.remove('active'));
			document.getElementById(mode).classList.add('active');
		}
		function showStatus (msg, type) {
			const s = document.getElementById('status-message');
			s.textContent = msg; s.className = 'status-message status-' + type; s.style.display = 'block';
			setTimeout(() => s.style.display = 'none', 3000);
		}
		function copyToClipboard (id) {
			const el = document.getElementById(id);
			if (!el.value) { showStatus('无内容可复制', 'error'); return }
			el.select(); document.execCommand('copy'); showStatus('已复制到剪贴板', 'success');
		}
		function downloadText (id, filename) {
			const content = document.getElementById(id).value;
			if (!content) { showStatus('无内容可下载', 'error'); return }
			const blob = new Blob([content], { type: 'text/plain' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
			URL.revokeObjectURL(url); showStatus(`已下载 ${filename}`, 'success');
		}
		function clearArea (ids) { ids.forEach(i => document.getElementById(i).value = ''); showStatus('已清空', 'success') }
		function showProgress () {
			const p = document.getElementById('progress-bar'), f = document.getElementById('progress-fill');
			p.style.display = 'block'; f.style.width = '70%'; setTimeout(() => f.style.width = '100%', 100);
		}
		function hideProgress () { setTimeout(() => { document.getElementById('progress-bar').style.display = 'none'; document.getElementById('progress-fill').style.width = '0%' }, 500) }

		/* ================= CSV ↔ JSON 原函数 ================= */
		function setupFileInput (fileId, areaId) {
			document.getElementById(fileId).addEventListener('change', function (e) {
				const file = e.target.files[0];
				if (file) {
					const reader = new FileReader();
					reader.onload = ev => { document.getElementById(areaId).value = ev.target.result; showStatus('文件加载成功', 'success') };
					reader.onerror = () => showStatus('文件读取失败', 'error');
					reader.readAsText(file);
				}
			});
		}
		function convertCsvToJson () {
			const csv = document.getElementById('csv-input').value.trim();
			if (!csv) { showStatus('请输入CSV数据', 'error'); return }
			showProgress();
			try {
				const d = document.getElementById('csv-delimiter').value, hasHeader = document.getElementById('csv-headers').checked;
				const lines = csv.split('\n').filter(l => l.trim());
				function parseLine (l) {
					const r = []; let c = '', q = false;
					for (let i = 0; i < l.length; i++) {
						const ch = l[i], nx = l[i + 1];
						if (ch === '"') { if (q && nx === '"') { c += '"'; i++ } else q = !q }
						else if (ch === d && !q) { r.push(c.trim()); c = '' } else c += ch;
					}
					r.push(c.trim()); return r;
				}
				let heads = [], start = 0;
				if (hasHeader) { heads = parseLine(lines[0]); start = 1 } else {
					const f = parseLine(lines[0]); for (let i = 0; i < f.length; i++)heads.push(`列${i + 1}`);
				}
				const res = [];
				for (let i = start; i < lines.length; i++) {
					const vals = parseLine(lines[i]), obj = {};
					for (let j = 0; j < heads.length; j++)obj[heads[j]] = vals[j] || '';
					res.push(obj);
				}
				document.getElementById('json-output').value = JSON.stringify(res, null, 2);
				showStatus('CSV转JSON成功', 'success');
			} catch (e) { showStatus('转换失败：' + e.message, 'error') } hideProgress();
		}
		function convertJsonToCsv () {
			const j = document.getElementById('json-input').value.trim();
			if (!j) { showStatus('请输入JSON数据', 'error'); return }
			showProgress();
			try {
				let data = JSON.parse(j); if (!Array.isArray(data)) data = [data];
				const d = document.getElementById('json-delimiter').value, hasHeader = document.getElementById('json-headers').checked;
				const keys = new Set(); data.forEach(item => { if (typeof item === 'object' && item) Object.keys(item).forEach(k => keys.add(k)) });
				const headers = Array.from(keys); let csv = '';
				if (hasHeader) csv += headers.map(h => `"${h.replace(/"/g, '""')}"`).join(d) + '\n';
				data.forEach(item => {
					const row = headers.map(k => { const v = item[k] !== undefined ? item[k] : ''; return `"${String(v).replace(/"/g, '""')}"` });
					csv += row.join(d) + '\n';
				});
				document.getElementById('csv-output').value = csv; showStatus('JSON转CSV成功', 'success');
			} catch (e) { showStatus('转换失败：' + e.message, 'error') } hideProgress();
		}

		/* ================= 时间戳互转新增函数 ================= */
		function getPrecision () { return document.getElementById('ts-precision').value } // 's'|'ms'
		function getTimezone () { return document.getElementById('ts-timezone').value } // 'local'|'utc'
		function isSeconds () { return getPrecision() === 's' }
		function tsToString () {
			let v = document.getElementById('ts-input').value.trim();
			if (!v) { showStatus('请输入时间戳', 'error'); return }
			v = Number(v);
			if (!Number.isFinite(v)) { showStatus('时间戳必须是数字', 'error'); return }
			if (isSeconds()) v *= 1000;
			const d = new Date(v);
			if (d.toString() === 'Invalid Date') { showStatus('无效时间戳', 'error'); return }
			const str = getTimezone() === 'utc' ? d.toISOString() : d.toLocaleString('zh-CN', { hour12: false });
			document.getElementById('ts-output').value = str; showStatus('转换成功', 'success');
		}
		function stringToTs () {
			let str = document.getElementById('ts-output').value.trim();
			if (!str) { showStatus('请先输入时间字符串', 'error'); return }
			const d = new Date(str);
			if (d.toString() === 'Invalid Date') { showStatus('无法解析时间字符串', 'error'); return }
			let ts = getTimezone() === 'utc' ? d.getTime() : d.getTime();
			if (isSeconds()) ts = Math.floor(ts / 1000);
			document.getElementById('ts-input').value = ts; showStatus('转换成功', 'success');
		}
		function insertNow () {
			let ts = Date.now();
			if (isSeconds()) ts = Math.floor(ts / 1000);
			document.getElementById('ts-input').value = ts;
			tsToString();
		}

		/* ================= 初始化 ================= */
		document.addEventListener('DOMContentLoaded', function () {
			setupFileInput('csv-file', 'csv-input');
			setupFileInput('json-file', 'json-input');
		});
	</script>
</body>

</html>